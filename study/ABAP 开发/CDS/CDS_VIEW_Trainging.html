<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>CDS_VIEW_Trainging</title>
</head>
<body><p> <strong>ABAP CDS VIEW Training</strong></p>
<h1 id='1基础概念'>1.基础概念</h1>
<p>&nbsp;</p>
<h2 id='10-背景'>1.0 背景</h2>
<p>结构化查询语言 Structured Query Language (SQL)</p>
<p>SQL的三种子语言</p>
<p><strong>Data ManipulationLanguage (DML)</strong></p>
<p>	提供用于读取和更改数据库表和的内容的语句</p>
<p>	包含SELECT、INSERT、UPDATE和DELETE等语句。</p>
<p><strong>Data DefinitionLanguage (DDL)</strong></p>
<p>	提供用于创建数据库对象（如表和视图）并维护其属性的语句。</p>
<p><strong>DataControl Language (DCL)</strong></p>
<p>	涵盖数据完整性和安全性的各个方面。</p>
<p>&nbsp;</p>
<p>而 OpenSQL 是 ABAP 语言中内置 的 SQL 变体，仅涵盖 DML 方面。
且 OpenSQL 不仅将自己限制在 SQL 的 DML 部分, 对比MySQL，Oracle时，
Open SQL 中也缺少许多描述的 DML 功能 限制了很多的功能，例如 limit , Union </p>
<p><strong>这些限制有两个重要原因：</strong></p>
<p>	OpenSQL希望独立于数据库，不仅在语法方面，而且更重要的是在结果方面。必须保证 OpenSQL 语句在所有数据库上提供相同的结果。要做到这一点，最简单的方法是避免标准 SQL的那些特性，在这些特性中，数据库供应商对结果应该是什么样子有不同的看法。一个 例子是算术表达式，其中舍入规则在所有数据库上都不相同。</p>
<p>	ABAP 编程的基本性能规则始终是：使不必要的负载远离数据库。一般的假设是，应用程序 程序员遵循此规则，不会过多地使用更复杂的 SQL 功能，即使它们在 OpenSQL 中可用</p>
<p>&nbsp;</p>
<p><strong>SAPHANA和对代码到数据的需求</strong>
 从版本 7.4 开始，ABAP 系统完全支持 SAPHANA 时，这一切都发生了变化。</p>
<p>借助 SAPHANA，SAP 结合了硬件和软件技术的最新发展，以提供最先进的内存数 据库。 但是，SAPHANA不仅仅是一个数据库。多个数据分析引擎和内置应用程序平台允许在数据库层 本身执行详细的数据分析甚至应用程序逻辑。</p>
<p>为了从SAPHANA的功能中获得最大收益，有必要改变编程范式以及传统的应用程序设计。</p>
<p>&nbsp;</p>
<p><strong>为什么会有ABAP CDS VIEW?</strong></p>
<p>ABAP Core Data Services (CDS) View是SAP为解决数据访问和数据模型复杂性问题而引入的。传统上，ABAP开发人员不得不在代码中将业务逻辑和数据库操作混合在一起，这会导致代码难以理解和维护。此外，业务逻辑和数据模型也常常分散在多个地方，这会导致数据的一致性问题。</p>
<p>为了解决这些问题，ABAP CDS View被引入，它允许开发人员在较高的抽象层次上定义数据模型和业务逻辑，这样可以让代码更容易理解和维护。同时，由于CDS View可以直接在数据库层面上进行操作，因此也能大幅提升性能表现。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='11-什么是-abap-cdsview'>1.1 什么是 ABAP CDS_VIEW</h2>
<p><strong>CDS: Core Data Services</strong> 核心数据服务 （数据 + 服务）</p>
<p>包含了： DDL ： （model，数据定义）</p>
<p>	         QL： （Query Language 查询） open SQL 可以访问CDS view </p>
<p>		DCL：  CDS权限定义 </p>
<p>&nbsp;</p>
<p>CDS VIEW 简单来说就是一个 VIEW, </p>
<p>区别于原来的 ABAP VIEW,：支持更多的功能，完成更复杂的 VIEW
										（例如，增加了 外连接，Union，但不仅于此） </p>
<p>&nbsp;</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240515095838220.png" referrerpolicy="no-referrer" alt="image-20240515095838220"></p>
<p>&nbsp;</p>
<h2 id='12-abap-cds--hana-cds'>1.2 ABAP CDS / HANA CDS</h2>
<ul>
<li>ABAP CDS VIEW :</li>

</ul>
<p>是为了帮助我们在 ABAP 服务器上开发，完成代码下推的一种方式，（可以不只运用于 HANA 数据库）</p>
<p>（Code Push Down）将部分逻辑从AP推送到DB层，更好的发挥 SAP HANA 的运算能力</p>
<p><a href='https://help.sap.com/docs/ABAP_PLATFORM/f2e545608079437ab165c105649b89db/4ed1f2e06e391014adc9fffe4e204223.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/ABAP_PLATFORM/f2e545608079437ab165c105649b89db/4ed1f2e06e391014adc9fffe4e204223.html?locale=en-US</a></p>
<ul>
<li>HANA CDS VIEW</li>

</ul>
<p>借助VDM, 运用 HANA 数据库上，完成数据建模 </p>
<p>属于 HANA 数据库的一部分，  位于HANA XS层(HANA Extended Application Services), 其就是为了创建HANA数据库里的模型和开发原生的HANA应用而生的，使用NATIVE SQL, 脱离了HANA数据库单独谈HANA CDS view没有任何意义。</p>
<p><a href='https://help.sap.com/docs/SAP_HANA_PLATFORM/52715f71adba4aaeb480d946c742d1f6/421691c7c0514928b3f15030600ef964.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/SAP_HANA_PLATFORM/52715f71adba4aaeb480d946c742d1f6/421691c7c0514928b3f15030600ef964.html?locale=en-US</a></p>
<p>&nbsp;</p>
<h4 id='1相同点'>1.相同点</h4>
<ul>
<li>都是代码下推的一种方式，HANA CDS VIEW 更多为了帮助S4/HANA 系统实现代码下推</li>

</ul>
<p>&nbsp;</p>
<h4 id='2不同点'>2.不同点</h4>
<ul>
<li>位置： ABAP CDS VIEW 位于 ABAP 应用服务器中 ； HANA CDS VIEW 位于 HANA XS Services 内</li>
<li>查看： ABAP CDS VIEW 可以用 SE11 查看 SQL View，； </li>
<li>数据源： ABAP CDS VIEW 还是我们 ABAP OPEN SQL 的； HANA CDS VIEW  是 HANA 数据中(Native SQL )</li>
<li>使用：ABAP CDS VIEW 用于开发 ABAP 技术栈的应用程序；HANA CDS View 用于开发 HANA 原生应用</li>
<li>编写：基本关键字差不多，语法使用不同</li>

</ul>
<p>&nbsp;</p>
<p><img src="./CDS_VIEW_Trainging.assets/2020042318333223.png" alt="img" style="zoom:67%;" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='13-abap-cds-view-作用--好处'>1.3 ABAP CDS VIEW 作用 &amp; 好处</h2>
<p>&nbsp;</p>
<p>1.因为是编译运行在 DB 层，相对AP 层会更快</p>
<p>2.代码下移，可以将一些AP层的逻辑下放到 DB 层帮忙处理</p>
<p>	数据密集型的计算会下推到数据库层</p>
<p>3.OData / Fiori  的开发需要用到 CDS_VIEW ,  </p>
<p>	Fiori Element</p>
<p>&nbsp;</p>
<h2 id='14-abap-cds-view-是怎么运行到hana-数据库中的'>1.4 ABAP CDS VIEW 是怎么运行到HANA 数据库中的</h2>
<p>ABAP CDS View是在ABAP环境中定义和开发的数据服务视图。当你创建一个ABAP CDS View并在你的程序中调用它时，ABAP运行环境会将这个CDS视图转化为SQL语句，并在关联的HANA数据库上执行。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='2创建'>2.创建</h1>
<p> </p>
<h2 id='21基本环境'>2.1基本环境</h2>
<p>（官方说明是可以在 Eclipse 或者 HanaStudio  进行开发）</p>
<p>如下是安装Eclipse 的步骤：（建议去官网参照最新的步骤）</p>
<p><img src="./CDS_VIEW_Trainging.assets/2023-11-24-14-38-42-image.png" referrerpolicy="no-referrer" alt="img"></p>
<h3 id='211-安装-eclipse'>2.1.1 安装 Eclipse</h3>
<p><a href='https://tools.hana.ondemand.com/#abap'>SAP HANA工具官方链接</a></p>
<p>（Ctrl + ‘左键’）</p>
<p><img src="./CDS_VIEW_Trainging.assets/2023-11-24-14-38-42-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p>&nbsp;</p>
<h3 id='212-安装-adt-插件'>2.1.2 安装 ADT 插件</h3>
<p>Abap Devolopment Tools </p>
<p><strong>【注意】</strong>如果不是最新的Eclipse版本，需要选择对应的ADT版本，不能直接使用</p>
<p>安装步骤包含在上图</p>
<p>&nbsp;</p>
<h3 id='213-创建abap-project'>2.1.3 创建ABAP Project</h3>
<p>安装ADT 成功后，可以开始新建 ABAP Project:</p>
<p>步骤：File ==&gt; New ==&gt; ABAP Project (/Project)</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240517095115840.png" referrerpolicy="no-referrer" alt="image-20240517095115840"></p>
<p>&nbsp;</p>
<p>然后选中我们登入的环境和端口：一直 Next 就行</p>
<p>（这里应该是ADT 直接从GUI 的配置文件中带出来的）</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240517095323286.png" referrerpolicy="no-referrer" alt="image-20240517095323286"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='22-创建-cds-view'>2.2 创建 CDS VIEW</h2>
<p>&nbsp;</p>
<h4 id='221-creating-data-definitions'>2.2.1 Creating Data Definitions</h4>
<ul>
<li>1.新建项目</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426170402924.png" referrerpolicy="no-referrer" alt="image-20240426170402924"></p>
<ul>
<li>2.找到  <strong>Core Data Services</strong> &gt;&gt; <strong>Data Definition</strong> </li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426170527282.png" referrerpolicy="no-referrer" alt="image-20240426170527282"></p>
<p>&nbsp;</p>
<ul>
<li>3.除了Project和Package，输入要创建的数据定义的Name和Description。然后点击下一步。</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426171236404.png" referrerpolicy="no-referrer" alt="image-20240426171236404"></p>
<ul>
<li>这里也可以点击 next ,去选中需要的模板，或者 Finish （默认用上一次使用的模板）</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426172015519.png" referrerpolicy="no-referrer" alt="image-20240426172015519"></p>
<ul>
<li>4.如果选择了非本地Package，需要选择TR（选择已有TR,或者新建）后，点击完成</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426172146695.png" referrerpolicy="no-referrer" alt="image-20240426172146695"></p>
<ul>
<li>4.1扩展（可以选择Next 后，选择不同模板有什么效果）这里是直接Finsih,用了最基础的模板</li>
<li>5.完成创建，这就是创建的基础框架，后续补充我们需要代码</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240426172858942.png" referrerpolicy="no-referrer" alt="image-20240426172858942"></p>
<p>&nbsp;</p>
<h4 id='222--demo-示例'>2.2.2  Demo 示例</h4>
<h5 id='demo-1'>Demo 1 </h5>
<p>需求：查询 Ticket 的相关数据，把表 ZMKPF &amp; ZMSEG 的数据一张 View 输出  （ZTDM_DDL_TICKET001）</p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_TICKET001&#39; //指定了数据库 CDS SQL View 的名字
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 2.1&#39;
define view ZTDM_E_Ticket001 //指定CDS View Entity 的名字，
  as select from    zmkpf as H
    left outer join zmseg as I on  H.werks  = I.werks
                               and H.mjahr  = I.mjahr
                               and H.ticket = I.ticket
{
  key H.werks,
  key H.mjahr,
  key H.ticket,
  key I.mblpo,
      H.bwart,
      I.matnr,
      I.maktx,
      I.mblnr,
      H.status
}
where
  H.ticket = &#39;4000000001&#39;
</code></pre>
<h5 id='demo-2'>Demo 2 </h5>
<p>需求：查询MARD中指定Plant,库存大于0的物料数据 , ( ZTDM_DDL_MARD001 )</p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_MARD001&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 2.2&#39;
define view ZTDM_E_MARD001
  with parameters
    p_Werks : werks_d // 参数名区分大小写
  as select from nsdm_v_mard as M // DB的MARD 与 AP的MARD 数据源不同
{
      @EndUserText.label: &#39;Plant&#39;
  key M.werks,
      @EndUserText.label: &#39;Storage location&#39;
  key M.lgort,
      @EndUserText.label: &#39;Material Number&#39;
  key M.matnr,
      @EndUserText.label: &#39;Valuated Unrestricted-Use Stock&#39;
      M.labst,
      @EndUserText.label: &#39;Stock in Quality Inspection&#39;
      M.insme,
      @EndUserText.label: &#39;Blocked Stock&#39;
      M.speme
}
where
       werks = $parameters.p_Werks
  and(
       labst &gt; 0
    or insme &gt; 0
    or speme &gt; 0
  )
</code></pre>
<p>&nbsp;</p>
<h2 id='23-cdsview-基本代码框架'>2.3 CDS_VIEW 基本代码框架</h2>
<p>&nbsp;</p>
<p>【注解】 <strong>@AbapCatalog.sqlViewName:</strong>  指定了数据库 CDS SQL View的名字，在CDS View激活时，会在数据库层生成对应的SQL View , 和 ABAP SQL View  一样，（最长16个字符，且都为大写 ）</p>
<p>【注解】<strong>@AbapCatalog.preserveKey: true</strong> 注解的值为TRUE时，SQL view中的key字段使用CDS中定义的key； 值为FALSE时，使用DB table中table的key field.</p>
<p>【注解】<strong>@AccessControl.authorizationCheck: #NOT_REQUIRED</strong> 权限检查注解，NOT_REQUIRED 为有对应的权限管控时则会执行权限检查，否则不执行</p>
<p>【基本定义】</p>
<p><strong>define view ZMM_DDL_DEMO</strong> : 定义的CDS View的名字，CDS View 实体名 </p>
<pre><code class='language-abap' lang='abap'>as select from    zmseg as I
  left outer join zmkpf as H on  H.werks  = I.werks
                             and H.mjahr  = I.mjahr
                             and H.ticket = I.ticket
</code></pre>
<p><strong>as select from</strong> : 指定了CDS View的数据源</p>
<p><strong>{ }</strong> : 中定义了CDS view中包含哪些字段</p>
<p><strong>where :</strong> 指定查询的条件  (where 不是必需的)</p>
<p>&nbsp;</p>
<p>【注意】命名时：SQL View name 最长16位字符；全大写</p>
<p>			       CDS View name最长30位字符，区分大小写可以使用驼峰命名</p>
<p>&nbsp;</p>
<h2 id='24-ddic-上的三个工件'>2.4 DDIC 上的三个工件</h2>
<p>帮助理解 CDS VIEW</p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240425164153801.png" referrerpolicy="no-referrer" alt="image20240425164153801"></p>
<p>&nbsp;</p>
<h4 id='基本概念'>基本概念</h4>
<p><strong>DDL Source</strong> 源代码文件:  </p>
<p>	激活 DDL 源后，将创建两个对象：SQL 视图和 CDS 视图。它们都不能直接编辑</p>
<p>&nbsp;</p>
<p><strong>CDS View Entity</strong>：（建议使用这个作为SQL 中的数据源）</p>
<p>	相对SQL 视图具有更多的语义，但不能在SE11 直接查看数据，
​	可以在 SQL中使用</p>
<p>	CDS 实体的名称在 DEFINEVIEW 语句之后指定</p>
<p>	</p>
<p><strong>SQL View</strong> : 显示为数据字典对象  ，可以用于再SE11查看数据，（注：带参数的不能查看数据)</p>
<p>	SQL 视图的名称在 Annotation@ABAPCatalog.sqlViewName 之后指定。它必须与 CDS 实体 的名称不同。与任何词典视图一样，最大长度为 16 个字符。</p>
<p>&nbsp;</p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240509170712463.png" referrerpolicy="no-referrer" alt="image-20240509170712463"></p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240509173700154.png" referrerpolicy="no-referrer" alt="image-20240509173700154"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='3语法--语义'>3.语法 &amp; 语义</h1>
<p>&nbsp;</p>
<h2 id='31基本表达式'>3.1基本表达式</h2>
<p>&nbsp;</p>
<pre><code>(先说明，CDS VIEW 还是属于SAP, ABAP 里有的元素 它一样都拥有，Field ,Data Element）
(使用时，可以借助 F2 快捷键 查看元素内容)
</code></pre>
<p>&nbsp;</p>
<h3 id='310-值'>3.1.0 值</h3>
<ul>
<li>系统值</li>

</ul>
<figure class='table-figure'><table>
<thead>
<tr><th>&nbsp;</th><th>&nbsp;</th></tr></thead>
<tbody><tr><td>$projection. :</td><td>代指当前CDS VIEW , 可以用来指向当前CDS VIEW 的栏位、参数</td></tr><tr><td>$session.</td><td>类似ABAP 的 sy-  , 使用系统变量的header<br /> 例如：当前日期：$session.system_date<br />             当前端口：$session.clint<br />             系统语言：$session.system_language<br />             登录用户：$session.user</td></tr></tbody>
</table></figure>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240515091308012.png" referrerpolicy="no-referrer" alt="image-20240515091308012"></p>
<ul>
<li>常量</li>

</ul>
<p>1.使用 单引号包起来的则为 字符， </p>
<p>	根据是否为纯数字 分为 Char 、Numc</p>
<p>2.不使用单引号包起来的，则为数字，允许有小数点，</p>
<pre><code class='language-abap' lang='abap'>{
  &#39;ABCD字&#39; as Field1,  //char
  &#39;123.22&#39; as Field2, //numc
  // 123.ss 因为有字符，则必须用单引号包起来
  123 as Field3,      //int
  1234 as Field4,
  32767 as Field5,
  32768 as Field6,    // 待验证是否会根据值变换 字符类似(Int1/Int4)
  123.22 as Field7,

}
</code></pre>
<p>可以用于后续，AP层 循环里面根据某个值判定为某种类型、</p>
<p>&nbsp;</p>
<h3 id='311-build-in'>3.1.1 Build-in</h3>
<p>描述：CDS中自带的一些运算函数</p>
<pre><code>使用：

- **concat ( )** 拼接两个字符串，
- **substring( )** 获取字符串中的一个子串。
- 更多可用的Build-in函数可以查找ABAP的帮助文档

div(arg1,arg2):输入整数，整除；

mod(arg1,arg2):输入整数，取余；

division(arg1,arg2,dec):输入整数或小数，除法；

abs(arg):取绝对值；

floor(arg):向下取整；

ceil(arg):向上取整；

round(arg,pos):四舍五入，pos保留小数位；

concat(arg1,arg2):字符拼接；

replace(arg1,arg2,arg3):使用arg3替换arg1中所有arg2;

substring(arg,pos,len):从pos开始，截取len长度；

concat_with_space(arg1,arg2,count):使用count个space连接arg1,arg2；

length(arg):返回长度；

left(arg,n):左边n个字符；

right(arg,n):右边n个字符；

lower(arg)：转换小写，numc,dats,tims不允许输入；

upper(arg):转换大写，numc,dats,tims不允许输入；

unit_conversion():单位转换，

Tcode:CUNI维护单位；

currency_conversion():币别转换，

Tcode:OB08,维护币别；
</code></pre>
<p>&nbsp;</p>
<p>可参考链接：</p>
<p><a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abenabap&amp;sap-language=EN&amp;version=X'>ABAP - Help</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds&amp;sap-language=EN&amp;version=X'>ABAP - Core Data Services (ABAP CDS)</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_entities&amp;sap-language=EN&amp;version=X'>ABAP CDS - Data Definitions</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_f1_ddl_syntax&amp;sap-language=EN&amp;version=X'>ABAP CDS - DDL for Data Definitions</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_view_entity&amp;sap-language=EN&amp;version=X'>ABAP CDS - CDS Entities</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_ddic_entity&amp;sap-language=EN&amp;version=X'>ABAP CDS - DDIC-Based Entities</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_v1_views&amp;sap-language=EN&amp;version=X'>ABAP CDS - DDIC-Based Views</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_define_view_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DEFINE VIEW ddic_based</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_select_statement_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DDIC-based View, SELECT</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_operands_and_expr_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DDIC-based View, SELECT, Operands and Expressions</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_expressions_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DDIC-based View, Expressions</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_builtin_functions_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DDIC-Based View, Built-In Functions</a> &gt; <a href='adtcom:/sap/bc/adt/docu/abap/langu?object=abencds_sql_functions_v1&amp;sap-language=EN&amp;version=X'>CDS DDL - DDIC-based View, sql_functions</a> &gt; </p>
<p>&nbsp;</p>
<h3 id='312-case'>3.1.2 Case</h3>
<p>描述：实现分支结构</p>
<p>使用：</p>
<ul>
<li>case...when...else...end as 构成分支运算的逻辑</li>
<li>when 语句中可以是逻辑表达式</li>
<li>else 最后没有找到时 ，Finally</li>
<li>end as 赋值结果</li>

</ul>
<p>&nbsp;</p>
<p>基本语法</p>
<pre><code class='language-abap' lang='abap'>case field
  when &#39;A&#39; then &#39;A1&#39;
  when &#39;B&#39; then &#39;B2&#39;
  else result 
END AS field2 // 重点记得最后给上目标栏位

case $parameters.P_SOFLG 
  when &#39;&#39; then mska.kalab
end as kalab,  
</code></pre>
<p>复杂嵌套语法;  加上判断条件，if , and</p>
<pre><code>case 
    when mard.werks = &#39;F137&#39; AND mard.lgort &gt; &#39;W101&#39; then mard.labst
</code></pre>
<p>&nbsp;</p>
<p>例，如下需求，不用单独为了如下功能加上一段循环，（具体情况具体分析）</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240429071918485.png" referrerpolicy="no-referrer"></p>
<p>&nbsp;</p>
<h3 id='313-cast-类型转换'>3.1.3 Cast 类型转换</h3>
<p>描述：强制类型转换</p>
<ul>
<li>CAST可以完成所需要的强制类型转换，进而实现在CDS中的运算需求；</li>
<li>其中abap.fltp代表转换为abap中的浮点型</li>

</ul>
<p>&nbsp;</p>
<pre><code class='language-abap' lang='abap'>case smoker
            when &#39;X&#39; then cast ( forcuram as abap.fltp ) * 1.3
            else          cast ( forcuram as abap.fltp ) * 0.9
            end as final_amount
</code></pre>
<p>&nbsp;</p>
<h3 id='314-coalesce函数'>3.1.4 COALESCE函数</h3>
<p>描述：常用用户处理NULL的状况，为NULL语设定默认值</p>
<ul>
<li>coalesce（arg1, arg2）: 如果arg1不为NULL则返回arg1的值，否则返回arg2的值</li>

</ul>
<pre><code class='language-abap' lang='abap'>coalesce( smoker,  &#39;unassigned&#39;) as somker_status
</code></pre>
<p>&nbsp;</p>
<h3 id='315-聚集'>3.1.5 聚集</h3>
<p>描述：帮助完成聚集运算，例如MIN，MAX，COUNT，SUM等</p>
<pre><code class='language-abap' lang='abap'>{
  planetype,
  min(price) as min_price,
  max(price) as max_price,
  sum(price) as sum_price,
  count(*)   as count_planes  /* 总条数 */

}
group by
  planetype
</code></pre>
<p>使用：使用聚集运算时，可以使用group by指定聚集的条件，也即按哪些字段进行分组统计。</p>
<p>&nbsp;</p>
<h4 id='3151-having语句'>3.1.5.1 Having语句</h4>
<p>描述：指定聚集运算过程中的筛选条件</p>
<pre><code class='language-abap' lang='abap'>group by
  planetype
having
  planetype = &#39;747-400&#39;
  or count(*)  &gt; 60
</code></pre>
<p>使用：</p>
<ul>
<li>Having中指定的条件字段，只能是group by中的字段的子集（对结果进行筛选）；</li>
<li>在Having中也可以使用聚集运算的中间结果集作为删选条件</li>

</ul>
<p>&nbsp;</p>
<h3 id='316-join'>3.1.6 join</h3>
<p>描述：与ABAP的连接一致，</p>
<ul>
<li>CDS支持Inner Join， Left Outer Join，Right Outer Join</li>

</ul>
<pre><code class='language-abap' lang='abap'>  as select from    zmseg as I
    left outer join zmkpf as H on  H.werks  = I.werks
                               and H.mjahr  = I.mjahr
                               and H.ticket = I.ticket
</code></pre>
<p>&nbsp;</p>
<h3 id='317-union'>3.1.7 UNION</h3>
<p>描述：UNION两个SELECT的结果集</p>
<p>使用：</p>
<ul>
<li><strong>UNION</strong> 可以合并两个SELECT的结果集，并自定去除重复的条目</li>
<li><strong>UNION ALL</strong> 合并结果集，保留重复的条目</li>
<li>合并的两个结果集要有相同字段数（<em>不同会怎么样</em>？）</li>
<li>合并结果集的列类型要兼容（<em>不同以哪个为主？</em>）</li>
<li>字段名称要相同</li>

</ul>
<pre><code class='language-abap' lang='abap'> as select distinct from sbook
{
  carrid as airline_code,
  connid as connection_number,
  fldate as flight_date
}
where
  carrid = &#39;DL&#39;

union  /* 合并两个结果集 */

select distinct from sflight
{
  carrid as airline_code,
  connid as connection_number,
  fldate as flight_date
}
where
  planetype = &#39;747-400&#39;
</code></pre>
<p>&nbsp;</p>
<h3 id='318-distinct-函数'>3.1.8 Distinct 函数</h3>
<p>如果结果集中有<a href='https://so.csdn.net/so/search?q=重复的&amp;spm=1001.2101.3001.7020'>重复的</a>条目，DISTINCt可排除结果集中的重复条目。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='32-annotation注解'>3.2 Annotation注解</h2>
<p>功能：能够将ABAP和特定于组件的元数据添加到任何CDS实体的源代码中。</p>
<p>作用：丰富数据模型，添加一些配置数据</p>
<p>&nbsp;</p>
<p>分类：</p>
<p>根据注释的一致性和有效性评估方式：</p>
<ul>
<li>ABAP annotations：由ABAP运行时环境评估（检查）</li>
<li>Component annotations：由相关的SAP框架评估（检查）</li>

</ul>
<p>视图注解: 元素注解：参数注解: 扩展注解: 功能注解： </p>
<p>&nbsp;</p>
<h3 id='321-视图注解'>3.2.1 视图注解</h3>
<figure class='table-figure'><table>
<thead>
<tr><th style='text-align:left;' >注解名</th><th>值</th><th>意义</th></tr></thead>
<tbody><tr><td style='text-align:left;' >@AbapCatalog.preserveKey:</td><td>true</td><td>值为TRUE时，SQL view中的key字段使用CDS中定义的key；</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>flase</td><td>值为FALSE时，使用DB table中table的key field.</td></tr><tr><td style='text-align:left;' >@AbapCatalog.sqlViewName:</td><td><SQL VIEW NAME></td><td>ABAP 词典中 CDS SQL VIEW 的名称。</td></tr><tr><td style='text-align:left;' >@AccessControl.authorizationCheck</td><td>#CHECK</td><td>会隐式执行访问控制，且有语法检查</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#NOT_REQUIRED</td><td>与#CHECK 类似，但没有语法检查警告</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#NOT_ALLOWED</td><td>不执行访问控制。</td></tr><tr><td style='text-align:left;' >@ClientHandling.algorithm：</td><td>#SESSION_VARIABLE</td><td>自动在Where语句中添加一个client处理语句</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<h3 id='322-元素注解'>3.2.2 元素注解</h3>
<figure class='table-figure'><table>
<thead>
<tr><th style='text-align:left;' >注解名</th><th>值</th><th>意义</th></tr></thead>
<tbody><tr><td style='text-align:left;' >@EndUserText.label:</td><td><String></td><td>；栏位文本描述</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<p>数量/金额栏位注解</p>
<figure class='table-figure'><table>
<thead>
<tr><th>Field Annotation</th><th>Semantic</th></tr></thead>
<tbody><tr><td>@Semantics.amount.currencyCode</td><td>Amount that references to a currency (@Semantics.quantity.unitOfMeasure)</td></tr><tr><td>@Semantics.quantity.unitOfMeasure</td><td>Amount that references to a unit(@Semantics.unitOfMeasure)</td></tr><tr><td>@Semantics.unitOfMeasure</td><td>Unit</td></tr><tr><td>@Semantics.currencyCode</td><td>Currency</td></tr><tr><td>@Semantics.text</td><td>true / flase (Text in human-readable form)</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<h3 id='32-vdm-注解'>3.2.* VDM 注解</h3>
<p>用于虚拟视图模型</p>
<p>SAP使用Annotation @VDM.viewType对CDS View进行内部构造和解释</p>
<figure class='table-figure'><table>
<thead>
<tr><th style='text-align:left;' >注解名</th><th>值</th><th>意义</th></tr></thead>
<tbody><tr><td style='text-align:left;' >@VDM.viewType: #</td><td>#BASIC</td><td>基础接口视图</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#COMPOSITE</td><td>提供从 BASIC 视图派生和/或组合的数据的视图</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#CONSUMPTION</td><td>供消费的视图 (用于特定应用目的的视图)</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<h3 id='32-odata-注解'>3.2.* OData 注解</h3>
<p>在打算生成 OData 服务时设置此注释。</p>
<figure class='table-figure'><table>
<thead>
<tr><th style='text-align:left;' >注解名</th><th>值</th><th>意义</th></tr></thead>
<tbody><tr><td style='text-align:left;' >@OData.publish：</td><td>true</td><td>当注释@ OData.publish被设置和CDS视图被激活时，生成OData服务</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>flase</td><td>&nbsp;</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<h3 id='32-隐式传参'>3.2.* 隐式传参</h3>
<p>在ABAP 使用OPEN SQL 时，会自动帮忙传入很多系统值，</p>
<p>但不是在OPEN SQL 上使用时，可能就需要我们自己传入</p>
<pre><code class='language-abap' lang='abap'>with parameters                            
   @Environment.systemField: #CLIENT       // 隐式传入 sy-mandt
   p_mandt : abap.clnt,
</code></pre>
<p>&nbsp;</p>
<p>可以隐式传参的不仅有 端口号，例如还有 当前系统语言，用户名等</p>
<pre><code class='language-abap' lang='abap'> @Environment.systemField: #USER
 @Environment.systemField: #SYSTEM_LANGUAGE 
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='33-association'>3.3 Association</h2>
<p>简述：功能上和  join 是一样的，在数据库级别上没有区别，使用上需要加上基数（两个表的数量关系）</p>
<p>默认是：   (<strong><code>LEFT OUTER JOIN</code> or <code>LEFT OUTER TO ONE JOIN</code></strong>)， 如果需要  INNER JOIN,需要额外添加</p>
<p>和JOIN 的区别：Join 会贪婪加载（ Eager Load ） Association：在不需要join表的数据时，会懒加载（Lazy Load）</p>
<p>			    它是按需连接，不需要时关联(暴露出来的关联)只是说明了一个关系，除非有人触发它，否则不会执行实际的连接，这样可以提高性能。</p>
<p>&nbsp;</p>
<p>Association 更多是为了复杂的业务，嵌套View 的情况下使用 。</p>
<p>&nbsp;</p>
<p>关联分三种：</p>
<ul>
<li><strong>Ad-hoc association</strong>: 定点关联，就是关联另外一个表或视图的一个或几个字段 </li>
<li><strong>exposed association</strong>: 全部关联，就是关联别人的整个表或者视图（前提条件是你这个关联的所有用来join的字段，都要展示在新定义的view里面）而且只有你这个整个表的字段真被用到了，才会在后台建View，不然后台是不会建的。</li>
<li><strong>filtered associations</strong>: 就是关联里面加了个过滤，只是写法有些不一样</li>

</ul>
<p>&nbsp;</p>
<h3 id='331-基数'>3.3.1 基数</h3>
<p>基数：用来表示关联的两个表或视图之间的数据关系，它以[MIN …MAX]的形式包含在关联的定义中。</p>
<p>意思：<strong>[0 . .1] =表示目标的基数可以是0或1。同样[0 . .N]表示目标表/视图基数可以从0到N。</strong></p>
<p>【注】-  这个不是必需的，默认基数是：<strong>[0..1]</strong></p>
<p>	   -  它不会在运行时进行验证，但会产生语法检查警告。</p>
<p><strong>最小值是可选的</strong></p>
<ul>
<li>最小值的默认值为0</li>
<li>[1]表示[0..1]</li>
<li>[3]表示[0..3]</li>
<li>[*]表示[0 .. *]</li>

</ul>
<p><strong>禁止值</strong></p>
<ul>
<li>最小值不能为*</li>
<li>最大值不能为0</li>

</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3 id='332-编写'>3.3.2 编写</h3>
<ul>
<li>关联条件上和 JOIN 的写法一致，即 ON 后面条件保持不变，只是关键字发生了变化</li>
<li>使用栏位上，没有显式源表的字段都取自主数据源</li>

</ul>
<p>【注意】：不能和带参数的VIEW 一起使用，</p>
<p>	    或者在 where 条件中使用 被关联表的栏位（ 因为可能会影响到结果集基数 ）。</p>
<p>&nbsp;</p>
<h4 id='demo-3321'>Demo 3.3.2.1 </h4>
<ul>
<li>ZTCC_DDL_TICKET001</li>

</ul>
<p>这里使用了 association 关联到了 zmseg , 并且结果集中，指定了 zmseg 的栏位， 这就是 <strong>Ad-hoc association</strong>（ 定点关联）</p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_TICKET002&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 3.3.1&#39; // Ad-hoc association
define view ZTDM_E_Ticket002
  as select from zmkpf as H
  //    left outer join zmseg as I
  association [0..*] to zmseg as _zmseg on  H.werks  = _zmseg.werks // association
                                        and H.mjahr  = _zmseg.mjahr
                                        and H.ticket = _zmseg.ticket
{
  key H.werks,  
  key H.mjahr,
  key H.ticket,
  key _zmseg.mblpo, //指定被关联Table的栏位
      bwart,        //没有指定数据源时，会取主数据源
      _zmseg.matnr,
      _zmseg.maktx,
      _zmseg.mblnr,
      _zmseg,
      H.status
}
where
  H.ticket = &#39;4000000001&#39;
</code></pre>
<p><strong>创建视图的底层SQL:</strong>  ZMKPF 外连接到 ZMSEG</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240514114224909.png" referrerpolicy="no-referrer" alt="image-20240514114224909"></p>
<p>&nbsp;</p>
<h4 id='demo-3322'>Demo 3.3.2.2 </h4>
<ul>
<li>ZTCC_DDL_TICKET003</li>

</ul>
<p>虽然使用了 associations，但是并没有 _zmseg  就是暴露出来的 association，但是在结果集中没有使用这个table的栏位，使用时两个表并不会建立连接。这张就是 <strong>exposed association</strong>:（全部关联）</p>
<pre><code>@AbapCatalog.sqlViewName: &#39;ZTCC_V_TICKET003&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 3.3.2&#39; // exposed association
define view ZTCC_E_Ticket003
  as select from zmkpf as H
  //    left outer join zmseg as I
  association [0..*] to zmseg as _zmseg on  H.werks  = _zmseg.werks
                                        and H.mjahr  = _zmseg.mjahr
                                        and H.ticket = _zmseg.ticket
{
  key H.werks,
  key H.mjahr,
  key H.ticket,
      bwart,
      _zmseg,
      H.status
}
where
  H.ticket = &#39;4000000001&#39;
</code></pre>
<p><strong>创建视图的底层SQL:</strong>  可以看到并没有取连接 ZMSEG </p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240514114726295.png" referrerpolicy="no-referrer" alt="image-20240514114726295"></p>
<p>&nbsp;</p>
<h4 id='demo-3323'>Demo 3.3.2.3</h4>
<ul>
<li>ZTCC_DDL_TICKET004</li>

</ul>
<p>在 Demo 3.3.2.1 的基础上，对被关联的 Table: ZMSEG 增加条件限制，对Table: ZMSEG生效，这个就是 <strong>filtered associations</strong>.</p>
<p>&nbsp;</p>
<pre><code>@AbapCatalog.sqlViewName: &#39;ZTDM_V_TICKET004&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 3.3.3&#39; //filtered associations
define view ZTDM_E_Ticket004
  as select from zmkpf as H
  //    left outer join zmseg as I
  association[0..*] to zmseg as _zmseg on  H.werks  = _zmseg.werks
                                       and H.mjahr  = _zmseg.mjahr
                                       and H.ticket = _zmseg.ticket
                                      with default filter _zmseg.mblnr &lt;&gt; &#39;&#39;  //增加过滤条件
{ 
  key werks,
  key H.mjahr,
  key H.ticket,
  key _zmseg.mblpo,
      bwart,
      _zmseg.matnr,
      _zmseg.maktx,
      _zmseg.mblnr, 
      _zmseg,
      H.status
}
where
  H.ticket = &#39;4000000001&#39;
</code></pre>
<p><strong>创建视图的底层SQL:</strong>  在关联条件时，加上了 mblnr 不等于空的条件</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240514134738589.png" referrerpolicy="no-referrer" alt="image-20240514134738589"></p>
<p>&nbsp;</p>
<h4 id='demo-3324'><strong>Demo 3.3.2.4</strong></h4>
<p><strong>association</strong> 默认的情况是   <code>LEFT OUTER MANY TO ONE JOIN</code>，也可能会因基数影响会是 <code>LEFT OUTER MANY TO MANY JOIN</code> ，但都属于是  <code>LEFT OUTER JOIN</code></p>
<p>如果需要使 association 为 <strong>INNER JOIN</strong>，需要额外添加 <strong>inner</strong> 。</p>
<p><strong>注意</strong> 使用<strong>内连接</strong>方式是，请不要填写<strong>基数</strong>，否则就会成会两张表先内连接，内连接的结果再取外连接副表，不是期望结果！！！</p>
<p>（这种连接方式其实更适用于在多层 View 嵌套的情况下使用，正常两个Table 可以直接使用 inner join）</p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_TICKET005&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 3.3.4&#39;
define view ZTDM_E_Ticket005
  as select from zmkpf as H
  //    left outer join zmseg as I
  association to zmseg as _zmseg on  H.werks  = _zmseg.werks // association
                                 and H.mjahr  = _zmseg.mjahr
                                 and H.ticket = _zmseg.ticket
{
  key H.werks,  
  key H.mjahr,
  key H.ticket,
  key _zmseg[inner].mblpo, //添加inner后，则会内连接 zmseg 
      bwart,               
      _zmseg.matnr,
      _zmseg.maktx,
      _zmseg.mblnr,
      _zmseg,
      H.status
}
where
  H.ticket = &#39;4000000001&#39;
</code></pre>
<p><strong>创建视图的底层SQL:</strong> </p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240514143838471.png" referrerpolicy="no-referrer" alt="image-20240514143838471"></p>
<p>&nbsp;</p>
<p>Demo 3.3.2.5 增加复杂嵌套视图 View , 可以联合到 VDM 一起 Demo</p>
<p>&nbsp;</p>
<h1 id='4-access-control-权限管控'>4. <strong>Access Control </strong>（权限管控） </h1>
<p>&nbsp;</p>
<h2 id='41-概念介绍'>4.1 概念介绍</h2>
<p><strong>ABAP CDS</strong> 支持基于数据控制语言<strong>DCL</strong>(Data Control Language)的访问控制。ABAP CDS中的访问控制进一步限制了从ABAP CDS中的 non-abstract CDS 实体中返回的数据。CDS访问控制主要基于以下几个方面:</p>
<p> （<em>non-abstract CDS 实体 ：可以理解为面向对象时的抽象类</em> ）</p>
<ul>
<li><strong>CDS Role</strong> 定义 使用CDS DCL语句 DEFINE ROLE。CDS角色不分配给单个用户，而是针对每个用户进行评估。</li>
<li><strong>访问规则</strong> 定义 是为 CDS Role 中的 CDS 实体 定义的。访问规则可以定义条件，但也提供自由访问。在CDS角色中，访问规则可以从另一个规则继承。</li>
<li><strong>访问条件</strong> 定义 是在 访问规则 中为 CDS实体 的元素定义的。访问条件主要基于文本值和当前用户的经典授权。</li>

</ul>
<p>在创建了CDS Entity之后你希望在DDL中保护它不被未授权访问，这时就可以使用基于eclipse的ABAP IDE中的向导为授权对象创建DCL源，在DCL源文件中定义CDS角色。</p>
<p>在创建DDL时使用DCL语句<code>DEFINE role</code>为CDS Entity定义CDS角色。这样当访问这个CDS Entity时，会检查以下内容:</p>
<pre><code>IF 为此CDS Entity定义CDS角色.
	IF 当前用户是否具有所需的权限.
		访问控制管理将使用传统的权限管理检查当前用户的权限，并仅读取有授权的数据.
	ELSE.
	 	
	ENDIF.
ELSE.
	返回全部数据
ENDIF.
</code></pre>
<p>&nbsp;</p>
<pre><code>如果为非抽象CDS实体定义了具有访问规则的CDS角色，则在每次读取ABAP SQL时隐式计算访问条件，除非使用注释@AccessControl的值#NOT_ALLOWED关闭访问控制。authorizationCheck或在ABAP SQL查询的FROM子句中添加WITH PRIVILEGED ACCESS。如果启用了访问控制，则只读取符合访问条件的数据。

每个CDS角色都在其单独的DCL源代码(可以理解为当前这个CDS VIEW)中定义。这些DCL源代码片段只能在ABAP开发工具(ADT)中编辑
</code></pre>
<p>&nbsp;</p>
<p>基本原理图：</p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240515023028870.png" referrerpolicy="no-referrer" alt="image-20240515023028870"></p>
<p>&nbsp;</p>
<p><strong>【注意】</strong>权限检查只检查这个 CDS  Entity, CDS SQL View 并不会被检查,也不能被检查，所以在日常使用时尽可能使用 CDS Entity</p>
<p>&nbsp;</p>
<h2 id='42-创建-access-control'>4.2 创建 Access Control</h2>
<p>[Help]<a href='https://help.sap.com/docs/ABAP_PLATFORM/f2e545608079437ab165c105649b89db/707332186bf41014b5040bee4e204223.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/ABAP_PLATFORM/f2e545608079437ab165c105649b89db/707332186bf41014b5040bee4e204223.html?locale=en-US</a>: </p>
<h3 id='421-创建'>4.2.1 创建</h3>
<ul>
<li>1.创建DCL</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240429170920251.png" referrerpolicy="no-referrer" alt="image-20240429170920251"></p>
<p>&nbsp;</p>
<ul>
<li>2.还需要输入待创建的访问控制的“Name”和“Description”。</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240429171238514.png" referrerpolicy="no-referrer" alt="image-20240429171238514"></p>
<ul>
<li>3.如果不是选择本地，则还需要选择TR</li>
<li>4.上一步点击Finish ，则默认生成模板的DCL，
    如果 点击 Next，则就是选择模板 </li>

</ul>
<pre><code class='language-abap' lang='abap'>@EndUserText.label: &#39;TEST - Access Control&#39;
@MappingRole: true
define role ZTDM_DCL_STOCK001 {
    grant
        select
            on
                cds_entity
                    where
                        entity_element_1 = &#39;literal_value&#39;
                        or entity_element_2 = aspect user;
                        
}
</code></pre>
<p>&nbsp;</p>
<h3 id='422-基本框架'>4.2.2 基本框架</h3>
<p><strong>【注解】</strong>@EndUserText.label: &#39;TEST - Access Control&#39;  // DCL 描述</p>
<p><strong>【注解】</strong>@MappingRole: true 是默认把这个role给所有用户。
			 		    false 目前ABAP CDS 还不支持 </p>
<p><strong>define role</strong> : 定义 CDS Role 名，会默认分配给访问的 用户</p>
<p><strong>grant select on</strong> cds_entity： 指定被增加权限管控的 CDS Entity， 一个CDS Role 可以指定多个 CDS Entity</p>
<p><strong>where</strong>：权限管控的条件，</p>
<p>&nbsp;</p>
<p><strong>相关使用的注解</strong></p>
<pre><code class='language-abap' lang='abap'>@AccessControl.authorizationCheck: #NOT_REQUIRED  &quot;有权限就检查，没有就不检查
								   #CHECK         &quot;需要检查权限
								   #NOT_ALLOWED   &quot;不执行权限检查
</code></pre>
<p>&nbsp;</p>
<h2 id='43-单层情况'>4.3 单层情况</h2>
<p><strong>Demo:</strong>  <strong>CDS Role</strong> - ZTDM_DCL_TICKET002 为 <strong>CDS Entity</strong>  - ZTDM_E_Ticket002 增加权限管控</p>
<p>增加权限检查:  增加字面条件检查 和 PFCG权限检查</p>
<pre><code class='language-abap' lang='abap'>@EndUserText.label: &#39;TEST - DCL for ZTDM_E_TICKET002&#39;
@MappingRole: true
define role ZTDM_DCL_TICKET002 {
    grant
        select on ZTDM_E_Ticket002  //权限检查只检查这个 CDS Entity, CDS SQL View 并不会被检查,也不能被检查
            where (werks) = aspect pfcg_auth (ZTCCAO0001, ZTCCWERKS, ACTVT = &#39;03&#39; ) 
              AND bwart &lt;&gt; &#39;912&#39;; 
                        
}
</code></pre>
<p>在有多个权限检查时，使用并集的关系，</p>
<p><strong>【注意】</strong>测试时请使用无权限账号，开发账号数据访问权限较大，并不会被权限管控卡出</p>
<p>【<strong>补充创建测试数据】</strong></p>
<pre><code>1.SU20 创建权限字段 Authorization Field
2.SU21 创建权限对象类 &amp; 权限对象 Authorization Object （ACTVT添加）
3.PFCG 权限分配 创建权限角色 （这里配置需要筛选的具体条件）
4.SU01 为账户分配 创建的角色
</code></pre>
<p>【<strong>测试时】</strong></p>
<p>可以使用 T-code: <strong>stauthtrace</strong> 做权限检查的跟踪</p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240515015333571.png" referrerpolicy="no-referrer" alt="image-20240515015333571"></p>
<p>&nbsp;</p>
<h2 id='44-嵌套情况'>4.4 嵌套情况</h2>
<p>假设为 CDS VIEW A 创建了 Access Control A , 然后 CDS VIEW B 用 A 作为数据源，</p>
<p>当在ABAP 访问  CDS VIEW B 时，并不会被  Access Control A 卡住，直接忽略。</p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_TICKET006&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 4.1&#39;
define view ZTDM_E_Ticket006 as select from ZTDM_E_Ticket002
{
  key werks,  
  key mjahr,
  key ticket,
  key mblpo, 
      bwart,        
      matnr,
      maktx,
      mblnr,
      status
}

</code></pre>
<p>当在ABAP访问 ZTDM_E_Ticket006时，并不会执行到 <strong>CDS Role</strong>  ZTDM_DCL_TICKET002 的权限管控</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='5-cds-table-function'>5. CDS Table Function</h1>
<ul>
<li>简单说和CDS_VIEW 的区别，类似于 Program 与 Function 的区别, 也可以在CDS_VIEW中被调用，帮助实现代码下推功能。</li>
<li><strong>CDS Table Function</strong> 是使用ABAP CDS语句DEFINE table function定义的，<strong>通过ABAP Managed Database Procedures</strong> (AMDP)<strong>创建</strong>ABAP CDS Table Function,并调用自定义类方法(此时的类方法，类似于在HANA DB 的存储过程，帮助完成某些逻辑)，</li>
<li>AMDP的基本思想： 数据库过程被定义和实现为全局类的方法。这种方法的实现由特定于数据库的脚本组成， 这些脚本只能在数据库上执行，而不能在 ABAP 堆栈上执行。</li>
<li>AMDP 框架在数据库上创建一个存储过程，并将 AMDP 方法的任何调用重定向（或转 发）到此存储过程。</li>

</ul>
<p>概念图:</p>
<p>	<img src="./CDS_VIEW_Trainging.assets/image-20240513173329566.png" referrerpolicy="no-referrer" alt="image-20240513173329566"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='51基本介绍'>5.1基本介绍</h2>
<p><strong>定义</strong> ：define table function ZTCC_DDL_TANLE</p>
<p><strong>数据源</strong>：implemented by method ztcc_cds_tf01=&gt;get_lgort_nums;</p>
<p>        	引用现有的AMDP函数，没有则需要额外创建这个类取实现 AMDP 方法，</p>
<p>（在ABAP上实现AMDP 方法，但在METHOD 和 ENDMETHOD 是用SQL Script 编写的，此语句将会被 S4 HANA 数据库编译运行）</p>
<p><strong>使用</strong>：和 Table 或者 View 一样被使用，可以在 ABAP 程序 ， CSD_VIEW 中使用， </p>
<p>	    （额外需要注意传参上，）</p>
<p>CDS框架通过在数据库上调用分配的函数来执行CDS表函数中的SELECT</p>
<p>思考：其实功能使用上，和CDS_View 没有上面区别，但可以借助到 类来帮助实现逻辑，类方法里面可以实现更加复杂的逻辑</p>
<p>相当于CDS_View 的功能以及满足不了，可以使用Table Function 来实现更加复杂的功能，</p>
<p>难点在于，还要再多学会 AMDP 面向对象的开发，或许我们懂面向对象的基本概念，但是ABAP 类的语法还需要再学习</p>
<p>&nbsp;</p>
<h2 id='52-创建--代码'>5.2 创建 &amp; 代码</h2>
<p>&nbsp;</p>
<h3 id='521-先建造-cds-table-function--ddl-source'>5.2.1 先建造 CDS Table Function , (DDL source)</h3>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-11-37-20-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-11-38-03-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p>&nbsp;</p>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-11-41-37-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-11-44-04-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p>&nbsp;</p>
<h3 id='522-补充table-function代码'>5.2.2 补充Table Function代码</h3>
<pre><code class='language-abap' lang='abap'>@EndUserText.label: &#39;TEST - DEMO 5.1&#39; // Test for Table Function
define table function ZTDM_DDL_TFunc0001 //定义名
with parameters                          //入参
    @Environment.systemField: #CLIENT    //隐式传参
    p_mandt: abap.clnt,
    p_matnr: matnr
returns {  							     //返回结果
     mandt : abap.clnt;  //系统参数
     matnr : matnr;
     werks : werks_d;
     lgort : lgort_d; 
}
implemented by method ztmd_cl_cds_tfunc_0001=&gt;get_lgort; //数据源，激活时不检查是否真的存在
</code></pre>
<p>&nbsp;</p>
<p><strong>with parameter :</strong> 定义需要使用该 CDS Table Function 需要传入的参数 （mandt 是否是必需的，还需要再确认）</p>
<p>				 （虽然这不是必需的，但建议有，因为 client 是需要通过传参的方式输入） </p>
<p><strong>returns { }</strong>: Table Function 返回的结果栏位</p>
<p><strong>implemented by method:</strong> （数据来源）实现AMDP接口 类的公共静态方法 </p>
<p>&nbsp;</p>
<h3 id='523-创建-amdp-类-数据源'>5.2.3 创建 AMDP 类 （数据源）</h3>
<ul>
<li>1.先创建类</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-11-58-01-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p>2.<strong>补充代码</strong></p>
<p>实现AMDP接口 <strong>IF_AMDP_MARKER_HDB</strong> (这是强制性的)</p>
<p>定义带有添加的 <strong>FOR TABLE FUNCTION</strong> 的公共静态方法</p>
<p> （只要补充静态方法就行 ）</p>
<p>该静态方法不自定义参数，使用关键字 FOR TABLE FUNCTION ，从CDS Table Function 获取到 该方法的参数。</p>
<pre><code class='language-abap' lang='abap'>CLASS ztmd_cl_cds_tfunc_0001 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES: if_amdp_marker_hdb.

    CLASS-METHODS:
      get_lgort
        FOR TABLE FUNCTION ZTDM_DDL_TFunc0001.

  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.

*实现公共静态方法
CLASS ztmd_cl_cds_tfunc_0001 IMPLEMENTATION.

  METHOD get_lgort BY DATABASE FUNCTION
                   FOR HDB
                   LANGUAGE SQLSCRIPT
                   OPTIONS READ-ONLY
                   USING nsdm_e_mard.

    RETURN SELECT DISTINCT
                  t.mandt,
                  t.matnr,
                  t.werks,
                  t.lgort
             from nsdm_e_mard as t
            WHERE t.mandt = :p_mandt
              and t.matnr = :p_matnr;


  ENDMETHOD.

ENDCLASS.
</code></pre>
<p>实现的静态方法，不能在ABAP 程序中使用，可以被使用在其他的AMDP 方法中，</p>
<p>不同与其他AMDP 方法，该方法仅具有回传 return 参数， 以及由Table Function 定义的导入参数，</p>
<p>&nbsp;</p>
<p><strong>附加字段的意义：</strong></p>
<p><strong>BY DATABASE FUNCTION</strong> :</p>
<p>其使用了BY DATABASE FUNCTION， 定义了一个用于实现数据库函数的AMDP function实现, 实现CDS Table Function 的AMDP方法实现的参数接口，取自方法声明中添加FOR table function后指定的CDS Table Function的定义。</p>
<p><strong>FOR db</strong>：定义了使用该AMDP方法的数据库系统，HDB 代表 SAPHANA 数据库。这是目前 唯一支持的值。</p>
<p><strong>LANGUAGE  db_lang</strong>: 定义了实现方法所用的特定于数据库的语言,  目前使用的是 SQLSCRIPT。 </p>
<p>	<img src="E:\Appdata\typora\CDS_VIEW\CDS_VIEW_Trainging.assets\image-20240513142939488.png" referrerpolicy="no-referrer" alt="image-20240513142939488"></p>
<p><strong>OPTIONS</strong>:  用于指定特定于数据库的选项, 对于CDS来说 READ-ONLY 是唯一受支持的选项。 </p>
<p><strong>USING</strong>: 用于声明由 ABAP 字典管理的，在AMDP方法中使用的数据库对象（支持透明表和字典视图，不支持使用CDS VIEW Entity）。</p>
<p>	      简单说就是数据源，使用的是ABAP 字典中的对象，虽然不支持 CDS Entity , 但可以使用 CDS  DDL Source  生成的 CDS SQL View。</p>
<p>&nbsp;</p>
<p>ABAP - Help &gt; ABAP - Programming Language &gt; Processing External Data &gt; ABAP Database Access &gt; ABAP Managed Database Procedures (AMDP) &gt; AMDP - Methods &gt;</p>
<p>&nbsp;</p>
<h2 id='53-使用'>5.3 使用</h2>
<ul>
<li>激活建立的 CDS Table Function 以及 AMDP 类，则可以直接 Run CDS Table Function 展示结果。</li>
<li>可以被使用在 ABAP 程序中，也可以使用在 CDS VIEW 中，使用时更像一个带参数的CDS_VIEW。</li>
<li>对于创建的 AMDP 类，ABAP程序则不能直接调用，（但是可以通过间接的方式）。</li>

</ul>
<p><img src="./CDS_VIEW_Trainging.assets/2024-04-24-15-18-58-image.png" referrerpolicy="no-referrer" alt="img"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='6-vdm-虚拟视图模型'>6. VDM 虚拟视图模型</h1>
<p><strong>Virtual Data Models (VDM)</strong></p>
<h2 id='61-基本概念'>6.1 基本概念</h2>
<ul>
<li>VDM 是 SAP 的一种设计模式，它描述了数据应如何组织和访问以满足业务需求。VDM 的目标是提供统一的、一致的数据访问视图，隐藏底层数据源的复杂性。</li>
<li>组成：由基本视图（Basic interface Views）、复合视图（Composite interface Views）和消费视图（Consumption Views）组成，以满足不同层级的业务需求（类似Web后端开发中的三次架构）。</li>
<li>对于 HANA 来说  HANA CDS VIEW 是一种建模工具，能够定义数据的结构和计算逻辑。</li>
<li>VDM 的目标是提供一种统一的数据访问模型，它隐藏了底层数据源的复杂性，并提供了一种易于理解的视图，以满足业务需求。而 CDS Views 的目标是提供一种灵活的、高性能的数据建模工具，它可以在数据库层面进行优化，提供更好的性能。</li>

</ul>
<p>&nbsp;</p>
<p>使用到的<strong>注解</strong></p>
<figure class='table-figure'><table>
<thead>
<tr><th style='text-align:left;' >注解名</th><th>值</th><th>意义</th></tr></thead>
<tbody><tr><td style='text-align:left;' >@VDM.viewType: #</td><td>#BASIC</td><td>视图构成核心数据基础，没有数据冗余。</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#COMPOSITE</td><td>提供从BASIC视图派生和/或组合的数据。</td></tr><tr><td style='text-align:left;' >&nbsp;</td><td>#CONSUMPTION</td><td>于特定的应用程序目的，并基于基本或复合或交易视图定义。</td></tr></tbody>
</table></figure>
<p>&nbsp;</p>
<p>简单说：</p>
<ul>
<li><p>通常一个虚拟数据模型由<strong>4部分组成</strong>：</p>
<ul>
<li>Consumption Views 供消费的视图</li>
<li>Composite interface views 复合接口视图</li>
<li>Basic interface views 基础接口视图</li>
<li>Database tables 数据库表</li>

</ul>
</li>

</ul>
<pre><code>Basic interface views 基础接口视图
基本接口视图构建在数据库表之上。基本接口视图是虚拟数据模型的底层。只有基本接口视图才能访问数据库表。所有其他的CDS视图都重用，可以从基本接口视图取它们的数据。

Comosite Interface Views复合接口视图
Composite interface views是建立在Basic interface views和其它Composite interface views之上的。它在虚拟数据模型中的中间层。这种项目数据一般用于应用程序和Consumption views消费视图，或者组合来自多个数据源的数据以从其他复合视图中重用。

Consumption Views消费视图
Consumption Views是建在Composite interface views之上的，是虚拟数据模型的最上层，顾名思义就是最终被用来消费用的
</code></pre>
<p>&nbsp;</p>
<p><strong>使用：</strong></p>
<p>避免冗余ABAP CDS View 使用consistent name提供consistent model help to maintain an overview 从业务角度将数据结构化为一个个逻辑单元，更多用于事务和分析应用程序以及API。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>参考链接</strong></p>
<p><a href='https://help.sap.com/docs/ABAP_PLATFORM_NEW/cc0c305d2fab47bd808adcad3ca7ee9d/cf2989f6f5944305a0c8bcc0b0080c7c.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/ABAP_PLATFORM_NEW/cc0c305d2fab47bd808adcad3ca7ee9d/cf2989f6f5944305a0c8bcc0b0080c7c.html?locale=en-US</a></p>
<p><strong>参考实例图</strong></p>
<p><img src="./CDS_VIEW_Trainging.assets/image-20240507091757164.png" referrerpolicy="no-referrer" alt="image-20240507091757164"></p>
<p>&nbsp;</p>
<h2 id='62-demo'>6.2 Demo</h2>
<p>需求：根据 ABAP Function - ZIMDE073 的逻辑 创建了如下模型：</p>
<p><strong>Basic Views</strong>： ZTDM_E_MSKA001 , ZTDM_E_MSLB001 ，ZTDM_E_MARD001</p>
<pre><code>作用：分别从 底层表 获取到库存大于0数据（MARD,MSKA,MSLB）
</code></pre>
<p><strong>Composite Views</strong>： ZTDM_E_I_Stock </p>
<p>	作用：把前面三张View 的数据根据业务逻辑 合并到一个View 中</p>
<p><strong>Consumption Views：</strong> ZTDM_E_C_Stock </p>
<p>	作用：把 ZTDM_E_I_Stock 的数据 整理后发布出去，供AP ，Odata 使用，</p>
<p>		   可以在此层视图根据需求添加上 Access Control </p>
<p>编辑时分别添加上注解 @VDM.viewType: 以及对应的值</p>
<p>&nbsp;</p>
<h3 id='621-demo---basic'>6.2.1 Demo - Basic </h3>
<p>&nbsp;</p>
<p><strong>ZTDM_DDL_MARD001</strong></p>
<p>此篇代码，Demo 2.2.2  已经展示</p>
<p>&nbsp;</p>
<p><strong>ZTDM_DDL_MSKA001</strong></p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_MSKA001&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 6.1&#39; //MSKA Inventory
@VDM.viewType: #BASIC
define view ZTDM_E_MSKA001
   with parameters
    P_WERKS : werks_d
  as select from mska
{
    @EndUserText.label: &#39;Plant&#39;
    key werks,
    @EndUserText.label: &#39;Storage location&#39;
    key lgort,
    @EndUserText.label: &#39;Material Number&#39;
    key matnr,
    @EndUserText.label: &#39;Batch Number&#39;
    key charg,
    @EndUserText.label: &#39;Special Stock Indicator&#39;
    key sobkz,
    @EndUserText.label: &#39;Sales and Distribution Document Number&#39;
    key vbeln,
    @EndUserText.label: &#39;Item number of the SD document&#39;
    key posnr,
    @EndUserText.label: &#39;Valuated Unrestricted-Use Stock&#39;
        kalab
        
}

where werks = $parameters.P_WERKS
  and kalab &gt; 0

</code></pre>
<p>&nbsp;</p>
<p><strong>ZTDM_DDL_MSLB001</strong></p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_MSLB001&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 6.1&#39; //MSLB Inventory
@VDM.viewType: #BASIC
define view ZTDM_E_MSLB001 
  with parameters
    P_WERKS : werks_d
  as select from mslb
{
    @EndUserText.label: &#39;Material Number&#39;
    key matnr,
    @EndUserText.label: &#39;Plant&#39;
    key werks,
    @EndUserText.label: &#39;Batch Number&#39;
    key charg,
    @EndUserText.label: &#39;Special Stock Indicator&#39;
    key sobkz,
    @EndUserText.label: &#39;Account Number of Supplier&#39;
    key lifnr,
    @EndUserText.label: &#39;Valuated Unrestricted-Use Stock&#39;
        lblab,
    @EndUserText.label: &#39;Stock in Quality Inspection&#39;
        lbins
}
where werks = $parameters.P_WERKS
  and ( lblab &gt; 0 or 
        lbins &gt; 0 )

</code></pre>
<p>&nbsp;</p>
<h3 id='622-demo---composite'><strong>6.2.2</strong> Demo - Composite</h3>
<p><strong>ZTDM_DDL_I_Stock</strong></p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_I_STOCK &#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: &#39;TEST - DEMO 6.1&#39;
@VDM.viewType: #COMPOSITE
define view ZTDM_E_I_Stock 
with parameters
  P_WERKS : werks_d ,
  P_NLFLG : char1 ,
  P_SOFLG : char1 ,
  P_SPFLG : char1 ,
  P_BKFLG : char1 
  as select from ZTDM_E_MARD001
                 ( p_Werks : $parameters.P_WERKS )
                 as mard
  left outer join ZTDM_E_MSKA001
                   ( P_WERKS : $parameters.P_WERKS )
                  as mska 
                  on mska.werks = mard.werks
                 and mska.lgort = mard.lgort
                 and mska.matnr = mard.matnr             
  left outer join ZTDM_E_MSLB001 
                   ( P_WERKS : $parameters.P_WERKS )
                  as mslb
                  on mslb.werks = mska.werks
                 and mslb.matnr = mska.matnr 
{
    key mard.werks,
    key mard.lgort,
    key mard.matnr,
        mard.labst,
        mard.insme,
        
    case $parameters.P_BKFLG 
      when &#39;&#39; then mard.speme
    end as speme,  

    case $parameters.P_SOFLG 
      when &#39;&#39; then mska.kalab
    end as kalab,
        
    case $parameters.P_SPFLG 
      when &#39;&#39; then mslb.lblab
    end as lblab,
    
    case $parameters.P_SPFLG 
      when &#39;&#39; then mslb.lbins
    end as lbins
        
}
</code></pre>
<p>&nbsp;</p>
<h3 id='623-demo---consumption'>6.2.3 Demo - Consumption</h3>
<p><strong>ZTDM_DDL_C_Stock</strong></p>
<pre><code class='language-abap' lang='abap'>@AbapCatalog.sqlViewName: &#39;ZTDM_V_C_STOCK&#39;
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@ClientHandling.algorithm: #SESSION_VARIABLE
@EndUserText.label: &#39;TEST - DEMO 6.1&#39; //For Function - ZIMDE073
@VDM.viewType: #CONSUMPTION
define view ZTDM_E_C_Stock 
with parameters
  P_WERKS : werks_d ,
  P_NLFLG : char1 ,
  P_SOFLG : char1 ,
  P_SPFLG : char1 ,  
  P_BKFLG : char1 
  as select from ZMM_DDL_STOCK_I( P_WERKS: $parameters.P_WERKS,
                                  P_NLFLG: $parameters.P_NLFLG,
                                  P_SOFLG: $parameters.P_SOFLG,
                                  P_SPFLG: $parameters.P_SPFLG,
                                  P_BKFLG: $parameters.P_BKFLG
                                 )
                 as STOCK                                
{
    key STOCK.werks,
    key STOCK.lgort,
    key STOCK.matnr,
        STOCK.labst,
        STOCK.insme,
        STOCK.speme,
        STOCK.kalab,
        STOCK.lblab,
        STOCK.lbins
}
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 id='63-使用'>6.3 使用</h2>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='7-扩展到odata--fiori'>7. 扩展到Odata / Fiori</h1>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='小工具--小技巧'>**.小工具 &amp; 小技巧</h1>
<p>&nbsp;</p>
<h3 id='主要参考文档'>主要参考文档</h3>
<p>&nbsp;</p>
<p>安装运行环境</p>
<p><a href='https://tools.hana.ondemand.com/#abap'>SAP Development Tools (ondemand.com)</a></p>
<p>&nbsp;</p>
<p>ABAP CDS VIEW 开发指导</p>
<p><a href='https://help.sap.com/docs/ABAP_PLATFORM_NEW/f2e545608079437ab165c105649b89db/df5d534075254682a81b59fb67ebd686.html?locale=en-US&amp;version=202110.002'>Annotation Propagation | SAP Help Portal</a></p>
<p>&nbsp;</p>
<p>About ABAP Programming Model for SAP Fiori</p>
<p><a href='https://help.sap.com/docs/ABAP_PLATFORM_NEW/cc0c305d2fab47bd808adcad3ca7ee9d/cf2989f6f5944305a0c8bcc0b0080c7c.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/ABAP_PLATFORM_NEW/cc0c305d2fab47bd808adcad3ca7ee9d/cf2989f6f5944305a0c8bcc0b0080c7c.html?locale=en-US</a></p>
<p>&nbsp;</p>
<p>ABAP 帮助文档</p>
<p><a href='https://help.sap.com/doc/abapdocu_753_index_htm/7.53/en-US/index.htm?file=abencds.htm' target='_blank' class='url'>https://help.sap.com/doc/abapdocu_753_index_htm/7.53/en-US/index.htm?file=abencds.htm</a></p>
<p>&nbsp;</p>
<p>SAP HANA 开发者指导</p>
<p><a href='https://help.sap.com/docs/SAP_HANA_PLATFORM/52715f71adba4aaeb480d946c742d1f6/421691c7c0514928b3f15030600ef964.html?locale=en-US' target='_blank' class='url'>https://help.sap.com/docs/SAP_HANA_PLATFORM/52715f71adba4aaeb480d946c742d1f6/421691c7c0514928b3f15030600ef964.html?locale=en-US</a></p>
<p>&nbsp;</p>
<h3 id='编写'>编写</h3>
<p>ABAP CDS VIEW 注释：</p>
<pre><code>// 1.单行注释 


/* 
  2.段落注释
*/ 
</code></pre>
<p>注释快捷键：Ctrl + Shift + &#39;&lt;&#39;</p>
<p>取消注释快捷键：Ctrl + Shift + &#39;&gt;&#39;</p>
<p>【注】在编写AMDP类中 快捷键同样，需要注意快捷键冲突</p>
<p>&nbsp;</p>
<h3 id='查看'>查看</h3>
<pre><code>F2 ：查看某个元素的内容

Ctrl + 左键： 可查看被使用的 Table  或者 View 的具体定义文件
</code></pre>
<p>&nbsp;</p>
<h3 id='eclipse-adt-使用'>Eclipse (ADT 使用)</h3>
<p>1.快捷键查看：</p>
<pre><code>Windows ==&gt; Performanse ===&gt; Key
</code></pre>
<p>2.代码补全</p>
<p>3.跳转 </p>
<pre><code>F3: 跳到定义处 （比如查看参数在哪里被创建的）
Alt + &lt;  , ALT + &gt;
</code></pre>
<p>4.检查某个东西在哪里使用过：</p>
<pre><code> Ctrl + Shift + g
</code></pre>
<p>5.替换：</p>
<pre><code> 右键 --&gt; Rename	
</code></pre>
<p>6.Debug</p>
<pre><code>Debug 中的快捷和 GUI 一样
</code></pre>
<p>9.在Eclipse 里面用SAP GUI</p>
<pre><code>Ctrl + &#39;6&#39;
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 id='read-me'>Read me</h1>
<p><strong>版本：2024.05.17 -- Cheyenne</strong></p>
<p>&nbsp;</p>
<p><strong>使用&amp;查看 markdown 文档：</strong></p>
<p>    从别处 获取到 markdown 文档，请注意不仅要获取<strong>文档</strong>，还要获取 <strong>存放图片的文件夹</strong></p>
<p>    在文档图片的地址注意是 <strong>绝对路径</strong>，还是<strong>相对路径</strong>，</p>
<p>   <strong>查看的软件：</strong></p>
<p>	Typora： 这个最好用，但是需要付费，目前代码块 对ABAP CDS VIEW 语法没有适配的</p>
<p>	Marktext:  Github 开源 ，风格不同于 Typora</p>
<p>	以插件的形式：类似用 Vscode 安装插件打开，或者其他软件的插件，</p>
</body>
</html>